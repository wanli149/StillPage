# 书源自动分组功能实现说明

## 功能概述

实现了书源管理页面的自动分组功能，根据书源的内容类型自动将书源分类到四个预定义分组：小说、音乐、短剧、漫画。

## 主要特性

### 1. 自动分组
- **触发时机**: 当有新的未分组书源时自动触发
- **分组规则**: 基于书源的 `contentTypeHint` 字段和关键词检测
- **分组类别**: 
  - 小说 (TEXT/AUDIO/FILE类型)
  - 音乐 (MUSIC类型)
  - 短剧 (DRAMA类型) 
  - 漫画 (IMAGE类型)

### 2. 手动移动功能
- **批量移动**: 在选择模式下可批量移动书源到指定分组
- **单个移动**: 长按书源可快速移动到其他分组
- **菜单选项**: 提供"移动到分组"子菜单

### 3. 智能检测
- **关键词检测**: 基于书源名称和URL中的关键词自动识别内容类型
- **优先级**: 用户手动设置 > 系统检测 > 关键词检测
- **避免误判**: 只对有明确特征的书源进行自动分组

### 4. 用户界面优化
- **分组排序**: 内容类型分组优先显示，按固定顺序排列
- **视觉区分**: 内容类型分组在分组管理中有特殊标识
- **分隔线**: 内容类型分组和其他分组之间有视觉分隔

## 实现细节

### 核心文件修改

1. **BookSourceActivity.kt**
   - 添加内容类型分组常量
   - 实现自动分组检查逻辑
   - 优化分组菜单显示
   - 添加手动移动功能

2. **BookSourceViewModel.kt**
   - 实现自动分组算法
   - 添加书源移动方法
   - 智能内容类型检测

3. **BookSourceAdapter.kt**
   - 添加移动到分组的菜单项
   - 实现CallBack接口扩展

4. **GroupManageDialog.kt**
   - 内容类型分组的特殊显示
   - 防止删除内容类型分组

### 菜单资源修改

1. **book_source.xml** - 添加自动分组菜单项
2. **book_source_sel.xml** - 添加批量移动菜单
3. **book_source_item.xml** - 添加单个移动菜单

## 关键词检测规则

### 音频类 (归类到"小说")
- 中文: 有声、听书
- 英文: audio、podcast、radio

### 漫画类 (归类到"漫画")
- 中文: 漫画、连环画、绘本
- 英文: comic、manga

### 音乐类 (归类到"音乐")
- 中文: 音乐
- 英文: music、song、album、mv

### 短剧类 (归类到"短剧")
- 中文: 短剧
- 英文: drama、video、movie、film、tv、vod、watch、play、series、episode、season

## 使用方法

### 自动分组
1. 导入新书源后，系统会自动检测并分组
2. 手动触发: 设置 → 书源管理 → 分组菜单 → 自动分组

### 手动移动
1. **批量移动**: 选择多个书源 → 选择菜单 → 移动到分组 → 选择目标分组
2. **单个移动**: 长按书源 → 移动到分组 → 选择目标分组

### 分组管理
1. 内容类型分组显示特殊图标 📱
2. 内容类型分组不能删除，只能清空
3. 分组菜单中内容类型分组优先显示

## 注意事项

1. **保持兼容**: 不影响现有的分组功能
2. **用户控制**: 用户可以手动调整自动分组的结果
3. **性能优化**: 只对有明确特征的书源进行处理
4. **代码风格**: 遵循项目现有的代码规范和架构模式

## 测试建议

1. 导入不同类型的书源测试自动分组
2. 测试手动移动功能的各种场景
3. 验证分组菜单的显示和交互
4. 确认不会影响现有功能的正常使用